<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CellMap</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }
    </style>    

  </head>
  <body>
    <!-- <input type="file" id="fileInput"> -->
    <div id="map-canvas"></div>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=visualization"></script>
    <script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox.js"></script>
    <script type="text/javascript" src="public/javascripts/vendor/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="public/javascripts/vendor/underscore-min.js"></script>

    <script>
    $(document).ready(function(){
      // contenedor del archivo
      // var fileInput = document.getElementById('fileInput');

      var data = [];

      //Celda 1
      data.push([
        new google.maps.LatLng(8.5986,-71.1491771),
        new google.maps.LatLng(8.5986006,-71.1490648),
        new google.maps.LatLng(8.5985832,-71.1490567),
        new google.maps.LatLng(8.5986082,-71.1490044),
        new google.maps.LatLng(8.5985803,-71.1489593),
        new google.maps.LatLng(8.5986075,-71.1489929),
        new google.maps.LatLng(8.5986177,-71.1490217),
        new google.maps.LatLng(8.5986198,-71.1490374),
        new google.maps.LatLng(8.5986006,-71.1489752),
        new google.maps.LatLng(8.5985951,-71.1491278),
        new google.maps.LatLng(8.5986087,-71.1490088),
        new google.maps.LatLng(8.5986179,-71.1489868),
        new google.maps.LatLng(8.5985718,-71.1490706),
        new google.maps.LatLng(8.598611,-71.148988),
        new google.maps.LatLng(8.5986239,-71.14903),
        new google.maps.LatLng(8.5986051,-71.1491655),
        new google.maps.LatLng(8.5986099,-71.1490434)
      ]);

      //Celda 2
      data.push([
        new google.maps.LatLng(8.5984683,-71.1488406),
        new google.maps.LatLng(8.5984925,-71.1488625),
        new google.maps.LatLng(8.5985187,-71.1488967),
        new google.maps.LatLng(8.5985708,-71.1489496),
        new google.maps.LatLng(8.5984841,-71.1488442),
        new google.maps.LatLng(8.5984508,-71.1488348),
        new google.maps.LatLng(8.5985503,-71.1489467),
        new google.maps.LatLng(8.5984254,-71.1488376),
        new google.maps.LatLng(8.5985447,-71.1489347),
        new google.maps.LatLng(8.5984943,-71.1488815),
        new google.maps.LatLng(8.5985123,-71.1488981),
        new google.maps.LatLng(8.5984754,-71.1488358),
        new google.maps.LatLng(8.5985211,-71.1489354)
      ]);

       //Celda 3
       data.push([
        new google.maps.LatLng(8.5982696,-71.1487463),
        new google.maps.LatLng(8.5983786,-71.1488273),
        new google.maps.LatLng(8.5983445,-71.1488135),
        new google.maps.LatLng(8.5982414,-71.1487472),
        new google.maps.LatLng(8.598304,-71.1487903),
        new google.maps.LatLng(8.5983213,-71.1487956),
        new google.maps.LatLng(8.5982788,-71.148759),
        new google.maps.LatLng(8.5983651,-71.148825),
        new google.maps.LatLng(8.5982944,-71.1487736),
        new google.maps.LatLng(8.5983005,-71.1487811),
        new google.maps.LatLng(8.5984122,-71.1488368),
        new google.maps.LatLng(8.5984033,-71.1488313),
        new google.maps.LatLng(8.5983334,-71.1488063)
      ]);

      //  //Celda 4
        data.push([
        new google.maps.LatLng(8.5982367,-71.1487298),
        new google.maps.LatLng(8.5982215,-71.1487294),
        new google.maps.LatLng(8.5981818,-71.1487429)
      ]);


      //Celda 5
        data.push([
        new google.maps.LatLng(8.5981718,-71.1487355),
        new google.maps.LatLng(8.5981747,-71.1487051),
        new google.maps.LatLng(8.5981637,-71.1487219),
        new google.maps.LatLng(8.5981732,-71.1487347),
        new google.maps.LatLng(8.5981738,-71.1487242),
        new google.maps.LatLng(8.5981488,-71.1486803),
        new google.maps.LatLng(8.5981567,-71.148686)
      ]);


      function getRandomColor(){
        function c(){
          return Math.floor(Math.random()*256).toString(16);
        }
        return "#"+c()+c()+c();
      }

      function initialize() {
            var mapOptions = {
              zoom: 13,
              center: new google.maps.LatLng(8.5986, -71.1491771),
              mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            // inicializar mapa
            var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
            // inicializar bandas para centrar automaticamente
            var bounds = new google.maps.LatLngBounds();
            // inicializar lector de archivos
            // var fr = new FileReader();
            // evento de lectura de archivo
            // fr.onload = function(e) {
            //   var data = fr.result;
            //   if(data === null || data === undefined || data === "") return;
            //   // leer por lineas
            //   var lines = data.split('\n');
            //   _.each(lines, function(line, i){
            //     // remover el primer y ultimo parentesis
            //     line = line.substring(1, line.length-1);
            //     // buscar primer ]
            //     var pos = line.indexOf(']');
            //     // si no tiene ] pasar a la siguiente
            //     if(pos == -1) return;
            //     // obtener array de macs
            //     var macs = line.substring(1, pos);
            //     // separar por comas y contar los macs
            //     var count = macs.split(',').length;
            //     // obtener array de coordenadas
            //     var coords = line.substring(pos + 4, line.length - 1);
            //     // separar por comas las coordenadas
            //     // coords = JSON.parse(coords);
            //     console.log(coords);


            //   // lineSplit = line.split(',');
            //     console.log(coords);
            //   });
            // };
            // // leer archivo de texto
            // var file = fileInput.files[0];
            // fr.readAsText(file);

            // recorrer lineas
            var color1 = "#000000";
            var color2 = "#F9413B";
            _.each(data, function(cell, index){
              // generar color random por cada linea
              var color = index % 2 ? color1 : color2;

              
              // recorrer las coordenadas de la celda
              _.each(cell, function(item){
                var circleOptions = {
                  strokeOpacity: 0.6,
                  strokeWeight: 1,
                  fillOpacity: 0.1,
                  map: map,
                  center: item,
                  radius: 5,
                  strokeColor: color,
                  fillColor: color,


                };
                circle = new google.maps.Circle(circleOptions);
                bounds.extend(item);

                var labelText = "10";

                var myOptions = {
                  content: labelText,
                  boxStyle: {
                    textAlign: "center",
                    fontSize: "10pt",
                    fontWeigth: "bold",
                    borderRadius: "100%"

                  },
                  disableAutoPan: true,
                  position: item,
                  closeBoxURL: "",
                  isHidden: false,
                  pane: "mapPane",
                  enableEventPropagation: true
                };

                var label = new InfoBox(myOptions);
                label.open(map);

                google.maps.event.addListener(circle, 'center_changed', function () {
                label.setPosition(circle.getCenter());
                });
              });
            });

            // centrar automaticamente
            map.fitBounds(bounds);
      }

      // capturar evento cuando sube el archivo
      // fileInput.addEventListener('change', function(e) {
      //   initialize();
      // });

      initialize();
    });

    </script>

  </body>
</html>